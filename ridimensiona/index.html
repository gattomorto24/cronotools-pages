<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Ridimensiona - CronoTools 3.2</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .preset-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .preset-btn { background: var(--bg-tertiary); border: 1px solid var(--separator); padding: 8px; border-radius: 8px; font-size: 11px; color: var(--text-secondary); cursor: pointer; }
        .preset-btn:hover { background: var(--bg-secondary); border-color: var(--accent); color: var(--accent); }
        .size-input { background: var(--bg-tertiary); border: 1px solid var(--separator); color: var(--text-primary); padding: 10px; border-radius: 8px; width: 80px; text-align: center; font-weight: 600; }
    </style>
</head>
<body>
    <crono-navbar></crono-navbar>
    <div class="content-wrapper">
        <header class="main-header">
            <h1>Ridimensiona</h1>
            <p class="description">Preset rapidi o controllo manuale.</p>
        </header>

        <main>
            <div id="upload-stage" class="upload-area">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>
                <div class="upload-title">Carica Immagine</div>
                <input type="file" id="file-input" accept="image/*" hidden>
            </div>

            <div id="workspace-stage" class="workspace-container">
                <div class="canvas-wrapper"><canvas id="editor-canvas"></canvas></div>

                <div class="glass-card" style="padding: 20px; max-width: 500px; margin: 0 auto;">
                    
                    <div class="preset-grid">
                        <button class="preset-btn" onclick="applyPreset(1080, 1080)">IG Post 1:1</button>
                        <button class="preset-btn" onclick="applyPreset(1080, 1920)">IG Story</button>
                        <button class="preset-btn" onclick="applyPreset(1920, 1080)">Full HD</button>
                        <button class="preset-btn" onclick="applyPreset(1200, 630)">FB Link</button>
                        <button class="preset-btn" onclick="applyPreset(1500, 500)">X Header</button>
                        <button class="preset-btn" onclick="applyPreset(3840, 2160)">4K UHD</button>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: center; align-items: center;">
                        <input type="number" id="input-w" class="size-input" placeholder="W">
                        <button id="btn-lock" class="tool-btn active"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></button>
                        <input type="number" id="input-h" class="size-input" placeholder="H">
                    </div>
                    <button id="btn-apply" class="alert-btn primary" style="width: 100%; margin-top: 15px;">Applica</button>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button id="btn-download" class="alert-btn primary">Scarica</button>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/ui.js"></script>
    <script src="../js/core.js"></script>
    <script src="../components/navbar.js"></script>
    <script>
        const engine = new CronoEngine('editor-canvas');
        let locked = true;
        let aspect = 1;

        document.getElementById('upload-stage').addEventListener('click', () => document.getElementById('file-input').click());
        document.getElementById('file-input').addEventListener('change', (e) => { if(e.target.files.length) engine.loadImage(e.target.files[0]); });

        engine.on('imageLoaded', (d) => {
            document.getElementById('upload-stage').style.display = 'none';
            document.getElementById('workspace-stage').style.display = 'block';
            document.getElementById('input-w').value = d.width;
            document.getElementById('input-h').value = d.height;
            aspect = d.width / d.height;
        });

        document.getElementById('input-w').addEventListener('input', (e) => { if(locked) document.getElementById('input-h').value = Math.round(e.target.value / aspect); });
        document.getElementById('input-h').addEventListener('input', (e) => { if(locked) document.getElementById('input-w').value = Math.round(e.target.value * aspect); });

        document.getElementById('btn-lock').addEventListener('click', function() {
            locked = !locked;
            this.classList.toggle('active', locked);
            this.innerHTML = locked ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>' : '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path><line x1="2" y1="2" x2="22" y2="22"></line></svg>';
        });

        window.applyPreset = (w, h) => {
            document.getElementById('input-w').value = w;
            document.getElementById('input-h').value = h;
            // Presets ignore aspect ratio lock visually, but apply creates crop or stretch? Usually stretch for simple resize.
            // For CronoTools Simple Resize, we update inputs.
        };

        document.getElementById('btn-apply').addEventListener('click', () => engine.resize(parseInt(document.getElementById('input-w').value), parseInt(document.getElementById('input-h').value)));
        document.getElementById('btn-download').addEventListener('click', async () => engine.download(await engine.export('png'), 'resized.png'));
    </script>
</body>
</html>