<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Specchia Immagini - CronoTools</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <crono-navbar></crono-navbar>

    <div class="content-wrapper">
        <header class="main-header">
            <h1>Specchia</h1>
            <p class="description">Rifletti le tue immagini orizzontalmente o verticalmente in un istante.</p>
        </header>

        <main>
            <div id="upload-stage" class="upload-area">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>
                <div class="upload-title">Carica immagine</div>
                <div class="upload-desc">JPG, PNG, WEBP</div>
                <input type="file" id="file-input" accept="image/*" hidden>
            </div>

            <div id="workspace-stage" class="workspace-container">
                <div class="canvas-wrapper">
                    <canvas id="editor-canvas"></canvas>
                </div>

                <div class="toolbar-floating">
                    <button class="tool-btn" id="btn-undo" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 14L4 9l5-5"/><path d="M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11"/></svg>
                        Undo
                    </button>
                    
                    <button class="tool-btn" id="btn-flip-h" title="Orizzontale">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>
                        ↔ Oriz.
                    </button>

                    <button class="tool-btn" id="btn-flip-v" title="Verticale">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>
                        ↕ Vert.
                    </button>

                    <button class="tool-btn danger" id="btn-reset">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        Esci
                    </button>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button id="btn-download" class="alert-btn primary" style="padding: 16px 32px; font-size: 18px; width: 100%; max-width: 300px;">Scarica</button>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/ui.js"></script>
    <script src="../js/core.js"></script>
    <script src="../components/navbar.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const engine = new CronoEngine('editor-canvas');
            const uploadArea = document.getElementById('upload-stage');
            const fileInput = document.getElementById('file-input');
            const workspace = document.getElementById('workspace-stage');

            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) engine.loadImage(e.target.files[0]);
            });

            engine.on('imageLoaded', () => {
                uploadArea.style.display = 'none';
                workspace.style.display = 'block';
            });

            engine.on('historyChange', ({ canUndo }) => document.getElementById('btn-undo').disabled = !canUndo);
            document.getElementById('btn-undo').addEventListener('click', () => engine.undo());

            document.getElementById('btn-flip-h').addEventListener('click', () => engine.flip('h'));
            document.getElementById('btn-flip-v').addEventListener('click', () => engine.flip('v'));

            document.getElementById('btn-reset').addEventListener('click', () => window.location.reload());
            document.getElementById('btn-download').addEventListener('click', async () => {
                const blob = await engine.export('png');
                engine.download(blob, 'crono-flip.png');
            });
        });
    </script>
</body>
</html>